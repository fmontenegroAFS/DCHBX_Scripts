/*
 * Licensed Materials - Property of IBM
 * 
 * Copyright IBM Corporation 2012. All Rights Reserved.
 *
 * US Government Users Restricted Rights - Use, duplication or disclosure 
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 */
dojo.provide("hcr.HCRAjaxHandler");

dojo.require("dojox.xml.parser");

dojo.declare("HCRAjaxHandler", null, {

    TIMEOUT: 5000,

	call : function(link, parameters, callback) {
		console.log("Starting AJAX call for link " + link);
		var instance = this;
		dojo.xhrPost({
	        url: link,
	        content: parameters,
	        timeout: instance.TIMEOUT,
	        handle: function(dataOrError, args) {
	                var doc = dojox.xml.parser.parse(dataOrError);
	                var isError = dojo.query('error', doc).length > 0;
					if (isError){
						instance.handleError(dojo.query('error', doc)[0], args);
			     	} else {
			            instance.handleData(dojo.query('data', doc)[0], args, callback);
			     	}
			     }
	    });
	},
	
	handleError : function(err, args) {
	    var message = "Error: " + dojox.xml.parser.textContent(dojo.query('message', err)[0]);
		console.log(message);
		alert(message);
	},
	
	handleData : function(data, args, callback) {
		if (callback) {
			callback(data, args);
		} else {
			console.log("No callback for data " + data);
		}
	},

    updateContent : function(contentPane, callback) {
    
        contentPane = dijit.registry.byId(contentPane.id);
        
        contentPane.onDownloadEnd = callback;
        
    	console.log("Updating view for " + contentPane.id);
    	
    	contentPane.refresh();
    }
});