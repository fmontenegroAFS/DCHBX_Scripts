//>>built
define("curam/util/UIMFragment",["curam/define","curam/debug","curam/util/ScreenContext"],function(){
curam.define.singleton("curam.util.UIMFragment",{get:function(_1){
var _2=_1&&_1.pageID;
var _3=_1&&_1.url;
var _4=_1&&_1.params;
var _5=_1&&_1.onLoad;
var _6=_1&&_1.onDownloadError;
var _7=_1&&_1.targetID;
if(_7===""||typeof _7==="undefined"){
throw "UIMFragment: targetID must be set.";
}
var _8=null;
if(_3){
_8=_3;
}else{
_8=curam.util.UIMFragment._constructPath(_2)+curam.util.UIMFragment._addCDEJParameters()+curam.util.UIMFragment._encodeParameters(_4);
}
curam.debug.log("UIMFragment: GET to "+_8);
curam.util.UIMFragment._doService(_8,_7,_1,_5,_6);
},submitForm:function(_9){
var _9=dojo.fixEvent(_9);
var _a=_9.target;
dojo.stopEvent(_9);
var _b={url:curam.util.UIMFragment._constructFormActionPath(_a),form:_a,load:function(_c){
var cp=dijit.getEnclosingWidget(_a);
cp.set("content",_c);
},error:function(_d){
alert("form error: error!!");
}};
dojo.xhrPost(_b);
console.log(_9+" "+_a);
},_constructFormActionPath:function(_e){
var _f="";
if(window===window.top){
_f=curam.config.locale+"/";
}
return _f+_e.getAttribute("action");
},_initForm:function(_10){
var _11=dojo.query("form",dijit.byId(_10).domNode)[0];
if(_11){
dojo.connect(_11,"onsubmit",curam.util.UIMFragment.submitForm);
}
},_constructPath:function(_12){
var _13=window;
var _14=window.top;
return curam.util.UIMFragment._constructPathValue(_12,_13,_14);
},_constructPathValue:function(_15,_16,_17){
if(_15===""||typeof _15==="undefined"){
throw "UIMFragment: pageID must be set.";
}
var _18="";
if(_16.location.pathname===_17.location.pathname){
var _19=_17.curam&&_17.curam.config&&_17.curam.config.locale;
_18=(_19||"en")+"/";
}
return _18+_15+"Page.do";
},_encodeParameters:function(_1a){
if(typeof _1a==="undefined"||dojo.toJson(_1a)==="{}"){
curam.debug.log("UIMFragment: No params included in request.");
return "";
}
var _1b=[];
for(var _1c in _1a){
_1b.push(_1c+"="+encodeURIComponent(_1a[_1c]));
}
return "&"+_1b.join("&");
},_addCDEJParameters:function(){
return "?"+jsScreenContext.toRequestString();
},_doService:function(url,_1d,_1e,_1f,_20){
var cp=dijit.byId(_1d);
cp.onLoad=dojo.hitch(cp,curam.util.UIMFragment._handleLoadSuccess,_1e,_1f);
cp.preventCache=true;
cp.set("href",url);
},_handleDownloadError:function(_21){
curam.debug.log("Error invoking the UIMFragment: "+_21);
return "UIMFragment: Generic Error Handler";
},_handleLoadSuccess:function(_22,_23){
curam.util.UIMFragment._initForm(_22.targetID);
if(_23){
_23(this);
}
curam.debug.log("");
return "UIMFragment: Generic Success Handler";
}});
return curam.util.UIMFragment;
});
