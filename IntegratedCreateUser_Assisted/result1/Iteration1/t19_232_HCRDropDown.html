/*
 * Licensed Materials - Property of IBM
 * 
 * Copyright IBM Corporation 2012. All Rights Reserved.
 *
 * US Government Users Restricted Rights - Use, duplication or disclosure 
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 */
dojo.provide("hcr.HCRDropDown");

dojo.require("dijit.form.DropDownButton");

dojo.declare("HCRDropDown",dijit.form.DropDownButton,{
   templateString: "<span class=\"dijit dijitReset dijitLeft dijitInline\"\n\tdojoAttachPoint=\"_buttonNode\"\n\tdojoAttachEvent=\"onmouseenter:_onMouse,onmouseleave:_onMouse,onmousedown:_onMouse\"\n\t\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\t\t${nameAttrSetting} type=\"${type}\" value=\"${value}\"\n\t\t\t\tdojoAttachPoint=\"focusNode,titleNode,_arrowWrapperNode\"\n\t\t\t\twaiRole=\"button\" waiState=\"haspopup-true,labelledby-${id}_label\"\n\t\t\t\t><span class=\"dijitReset dijitInline \"\n\t\t\t\t\tdojoAttachPoint=\"containerNode,_popupStateNode\"\n\t\t\t\t\tid=\"${id}_label\"\n\t\t\t\t></span\n\t\t\t></span\n></span>\n",
   startup : function() {
       this.inherited(arguments);
       var THIS = this;
       dojo.connect(this.dropDown, "onMouseLeave", function() {THIS.closeDropDown(true);});
   }, 
   destroy : function() {
       this.inherited(arguments);
   }, 
   openDropDown : function() {
       this.inherited(arguments);
       
       //reset margins
       this.dropDown.domNode.style.marginLeft = 0;
       this.dropDown.domNode.style.marginRight = 0;
       
       var connector = dojo.query('.dijitTooltipConnector', this.dropDown.domNode)[0];
       var container = dojo.query('.dijitTooltipContainer', this.dropDown.domNode)[0];
       
       //positions
       var posAround = dojo.position(this._aroundNode, true);
       var posDropDown = dojo.position(this.dropDown.domNode, true);
       var posConnector = dojo.position(connector, true);
       
       //calculate middle position
       var leftConnector = posAround.w / 2 - posConnector.w / 2;
       var leftContainer = posAround.w / 2 - posDropDown.w / 2;
       
       //if overflows body on the left
       if (posDropDown.x + leftContainer < 0) {
           //move to left corner plus 10 pixels of relief
           leftContainer = posDropDown.x * -1 + 10;
       }
       
       //if overflows body on the right
       if (dojo.hasClass(this.dropDown.domNode, 'dijitTooltipABRight')) {
           connector.style.marginRight = leftConnector + "px";
       } else {
           connector.style.marginLeft = leftConnector + "px";
           this.dropDown.domNode.style.marginLeft = leftContainer + "px";
       }       
       
   }  
});