/*
 * Licensed Materials - Property of IBM
 * 
 * Copyright IBM Corporation 2013-2014. All Rights Reserved.
 *
 * US Government Users Restricted Rights - Use, duplication or disclosure 
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 */
hcr.eventHandler.registerAction(CancelPlanEnrollmentAction={

	eventType : 'cancel_plan_enrollment',
	
	execute : function(args) {
	
		CancelPlanEnrollmentAction.cancelPlanEnrollment(
			args.programID,
			args.members, 
			args.enrollmentID, 
			args.reenrolling);
	},
	
	cancelPlanEnrollment: function(programID, members, enrollmentID, reenrolling) {

    var motivationID = getMotivationID();

		// Ensure that the values are initialized properly to prevent the server call
		// from failing silently. This ensures that the server will be invoked
		// and failures will be reported when record lookups fail.
    if (typeof motivationID === "undefined") {
			motivationID = 0;
    }	
    if (typeof programID === "undefined") {
			programID = 0;
    }		
    if (typeof members === "undefined") {
			members = "";
    }
    if (typeof enrollmentID === "undefined") {
			enrollmentID = 0;
    }	    
    if (typeof reenrolling === "undefined") {
			reenrolling = "";
    }	
    
		var cancelUrl = cw.fragment.constructURL('HealthCare_actionCancelPlanEnrollment');
		var cancelParams = {
		    motivationID:motivationID, 
        members:members, 
        programID:programID,
        enrollmentID:enrollmentID, 
        reenrolling:reenrolling
		};
		cw.ajax.call(cancelUrl, cancelParams,
	        CancelPlanEnrollmentAction.cancelPlanEnrollmentCallback);
	},
	
	cancelPlanEnrollmentCallback: function(message, call) {
	
		var motivationID = getMotivationID();
		
		var programID = EligibilityResult.currentEnrollment.programID;
	
		cw.fragment.load(
			'background-panel', 
			'CitizenWorkspace_eligibilityResultsUpdateAndReturn', 
			{motivationID:motivationID, programID:programID});
	}

});

