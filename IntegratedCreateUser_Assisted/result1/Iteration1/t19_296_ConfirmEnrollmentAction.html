/*
 * Licensed Materials - Property of IBM
 * 
 * Copyright IBM Corporation 2012. All Rights Reserved.
 *
 * US Government Users Restricted Rights - Use, duplication or disclosure 
 * restricted by GSA ADP Schedule Contract with IBM Corp.
 */
dojo.require("dojox.xml.parser");

hcr.eventHandler.registerAction(ConfirmEnrollmentAction={

	eventType : 'confirm_enrollment',
	
	execute : function(args) {
	
		ConfirmEnrollmentAction.confirmEnrollment(
		    args.programID,
		    args.members, 
		    args.url, 
		    args.enrollmentID,
		    args.reenrolling);
		
	},
	
	confirmEnrollment: function(programID, members, url, enrollmentID, reenrolling) {
	
	    var motivationID = getMotivationID();
	    var confirmUrl = cw.fragment.constructURL('HealthCare_actionConfirmEnrollment');
	    var confirmParams = {
				motivationID:motivationID, 
				members:members, 
				programID:programID,
				enrollmentID:enrollmentID, 
				reenrolling:reenrolling
			};
	    cw.ajax.call(confirmUrl, confirmParams, 
	        ConfirmEnrollmentAction.confirmEnrollmentCallback);
	        
	},
	
	confirmEnrollmentCallback: function(message, call) {
	
	    var content = call.args.content;
	    content.amount = dojox.xml.parser.textContent(message.getElementsByTagName("amount")[0]);
	    content.url = dojox.xml.parser.textContent(message.getElementsByTagName("url")[0]);
	    content.members = dojo.query('member', message); 
	    
	    cw.fragment.get({
	        targetID : 'background-panel', 
	        pageID : content.url, 
	        params : content
        });
	}

});

